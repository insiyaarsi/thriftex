<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Listing</title>
    <!-- CSS & Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link
      href="https://fonts.googleapis.com/css2?family=Euphoria+Script&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;700;900&display=swap"
      rel="stylesheet"
    />

    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/bootstrap-icons.css" rel="stylesheet" />

    <link rel="stylesheet" href="css/slick.css" />

    <link href="css/tooplate-little-fashion.css" rel="stylesheet" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa;
        overflow-x: hidden;
      }

      .form-group {
        margin-bottom: 15px;
      }
      .btn-save {
        background-color: black;
        color: white;
        width: 100%;
        height: 50px;
        border-radius: 5px;
      }
      .btn-save:hover {
        background-color: #ff4400;
        color: white;
      }
      .success-message {
        color: green;
        font-size: 14px;
        margin-top: 5px;
      }
      .error-message {
        color: red;
        font-size: 14px;
        display: block;
        margin-top: 5px;
      }
      .loading {
        display: none;
        text-align: center;
        margin: 10px 0;
        font-weight: bold;
        color: green;
      }
    </style>
  </head>
  <body style="overflow-x: hidden;">
    <div class="main">
      <div class="container" style="margin-left: -15px !important">
        <!-- Sidebar -->
        <div class="col-lg-3 col-md-4 col-12 mb-4 sidebar">
          <h3 id="user-dashboard-title">Seller Dashboard</h3>
          <a href="seller-dashboard.html"
            ><i class="bi bi-house-door-fill"></i> Dashboard</a
          >
          <a href="create-listing.html"
            ><i class="bi bi-bag-check-fill"></i> Create Listing</a
          >
          <a href="previous-listing.html"
            ><i class="bi bi-list-ul"></i> Previous Listings</a
          >
          <a href="seller-offer.html"><i class="bi bi-tag-fill"></i> Offers</a>
          <a href="unsold-listing.html"
            ><i class="bi bi-x-circle-fill"></i> Unsold</a
          >
          <a href="seller-orders.html"
            ><i class="bi bi-list-check"></i> Orders</a
          >
          <a href="index.html"><i class="bi bi-box-arrow-right"></i> Logout</a>

        </div>

       <!--Main Content-->
       <div class="main-content" style="width: 100%; padding-right: 227px">
        <div style="height: 35px" class="block-spacer"></div>

        <div
        class="col-lg-11 col-md-10 col-12 mb-4 container settings-container"
      >
      <h2 class="settings-title">Create Listing</h2>
            <form id="listing-form" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select
                  id="category"
                  name="category"
                  class="form-select"
                  required
                >
                  <option value="" selected>Select category</option>
                  <option value="clothing">Clothing</option>
                  <option value="accessories">Accessories</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="gender" class="form-label">Gender</label>
                <select id="gender" name="gender" class="form-select" required>
                  <option value="" selected>Select gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="material" class="form-label">Material</label>
                <input
                  type="text"
                  id="material"
                  name="material"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="color" class="form-label">Color</label>
                <input
                  type="text"
                  id="color"
                  name="color"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="size" class="form-label">Size</label>
                <input
                  type="text"
                  id="size"
                  name="size"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="images" class="form-label">Images</label>
                <input
                  type="file"
                  id="images"
                  name="images"
                  class="form-control"
                  multiple
                  accept="image/*"
                />
              </div>
              <div class="mb-3">
                <label for="condition1" class="form-label">Condition</label>
                <select
                  id="condition1"
                  name="condition1"
                  class="form-select"
                  required
                >
                  <option value="" selected>Select condition</option>
                  <option value="New with tags">New with tags</option>
                  <option value="New without tags">New without tags</option>
                  <option value="Pre-owned">Pre-owned</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea
                  id="description"
                  name="description"
                  class="form-control"
                  rows="4"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="price" class="form-label">Price</label>
                <input
                  type="number"
                  id="price"
                  name="price"
                  class="form-control"
                  step="0.01"
                  required
                />
                <div
                  id="price-error"
                  class="text-danger mt-1"
                  style="display: none; font-size: 14px"
                >
                  Price must be greater than 0.
                </div>
              </div>
              <div class="loading" id="loading">Submitting your listing...</div>
              <button
                type="submit"
                id="submit-btn"
                class="btn btn-save w-100"
              >
                Submit
              </button>
            </form>
          </div>
        </div>
      </div>
      </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("listing-form");
    const loading = document.getElementById("loading");
    const submitBtn = document.getElementById("submit-btn");
    const priceInput = document.getElementById("price");
    const priceError = document.getElementById("price-error");
    const titleInput = document.getElementById("title");
    const materialInput = document.getElementById("material");
    const colorInput = document.getElementById("color");

    // Error message elements
    const titleError = document.createElement("div");
    titleError.className = "error-message";
    titleInput.insertAdjacentElement("afterend", titleError);

    const materialError = document.createElement("div");
    materialError.className = "error-message";
    materialInput.insertAdjacentElement("afterend", materialError);

    const colorError = document.createElement("div");
    colorError.className = "error-message";
    colorInput.insertAdjacentElement("afterend", colorError);

    // Title validation: Only letters (no numbers, no special characters)
    titleInput.addEventListener("input", () => {
        const titleRegex = /^[A-Za-z\s]+$/;
        if (!titleRegex.test(titleInput.value)) {
            titleError.textContent = "Enter a valid title. Numbers, Special Characters not accepted";
        } else {
            titleError.textContent = "";
        }
    });

    // Material validation: Only letters, commas, and semicolons
    materialInput.addEventListener("input", () => {
        const materialRegex = /^[A-Za-z\s,;]+$/;
        if (!materialRegex.test(materialInput.value)) {
            materialError.textContent = "Only letters, ',' and ';' are allowed.";
        } else {
            materialError.textContent = "";
        }
    });

    // Price validation: Only numbers and decimal points
    priceInput.addEventListener("input", () => {
        const priceRegex = /^[0-9]*\.?[0-9]*$/;
        if (!priceRegex.test(priceInput.value)) {
            priceError.style.display = "block";
            priceError.textContent = "Enter a valid price. Only numbers and a single decimal point are allowed.";
        } else {
            priceError.style.display = "none";
        }
    });

    // Color validation: Only letters, commas, and semicolons
    colorInput.addEventListener("input", () => {
        const colorRegex = /^[A-Za-z\s,;]+$/;
        if (!colorRegex.test(colorInput.value)) {
            colorError.textContent = "Only letters, ',' and ';' are allowed.";
        } else {
            colorError.textContent = "";
        }
    });

    // Form submission validation
    form.addEventListener("submit", async (e) => {
        e.preventDefault(); // Always prevent default first

        // Check if there are any validation errors
        if (titleError.textContent || materialError.textContent || priceError.style.display === "block" || colorError.textContent) {
            alert("Please correct the errors before submitting.");
            return; // Stop form submission
        }

        // Additional check for price (must be > 0)
        const price = parseFloat(priceInput.value);
        if (isNaN(price) || price <= 0) {
            priceError.style.display = "block";
            priceError.textContent = "Price must be greater than 0.";
            return; // Stop form submission
        } else {
            priceError.style.display = "none";
        }

        // Show loading and disable button
        loading.style.display = "block";
        submitBtn.disabled = true;

        const formData = new FormData(form);

        try {
            const response = await fetch("http://localhost:3000/api/listings", {
                method: "POST",
                credentials: "include",
                body: formData,
            });

            const result = await response.json();
            loading.style.display = "none";
            submitBtn.disabled = false;

            if (response.ok) {
                alert("Listing created successfully!");
                window.location.href = "/seller-dashboard.html";
            } else {
                alert(`Error: ${result.message}`);
            }
        } catch (error) {
            console.error("Error submitting form:", error);
            loading.style.display = "none";
            submitBtn.disabled = false;
            alert("An error occurred. Please try again.");
        }
    });
});

    </script>
  </body>
</html>
